@model OpenDataVR.Models.JugadoresIndexVM

@{
    string Toggle(string col)
    {
        var o = Model.Orden ?? "Id";
        return o == col ? col + "_desc" : col;
    }

    string Arrow(string col)
    {
        var o = Model.Orden ?? "Id";
        if (o == col) return " ▲";
        if (o == col + "_desc") return " ▼";
        return "";
    }

    string BuildUrlOrden(string orden) => Url.Action("Index", "Jugadores", new
    {
        buscar = Model.Buscar,
        arquetipo = Model.Arquetipo,
        posicion = Model.Posicion,
        elemento = Model.Elemento,
        rol = Model.Rol,
        orden = orden,
        pagina = 1
    })!;
}

<h3 class="mb-3">Personajes legendarios</h3>

<button type="button" class="btn btn-outline-secondary mb-3" id="themeToggle">
    🌙 Modo oscuro
</button>

<!-- FILTROS -->
<form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
        <input class="form-control" type="text" name="buscar"
               placeholder="Buscar por nombre o apodo"
               value="@Model.Buscar" />
    </div>

    <div class="col-md-2">
        <select class="form-select" name="arquetipo">
            <option value="">Arquetipo</option>
            @foreach (var item in Model.Arquetipos)
            {
                <option value="@item.Value" selected="@(item.Value == Model.Arquetipo)">
                    @item.Text
                </option>
            }
        </select>
    </div>

    <div class="col-md-2">
        <select class="form-select" name="posicion">
            <option value="">Posición</option>
            @foreach (var item in Model.Posiciones)
            {
                <option value="@item.Value" selected="@(item.Value == Model.Posicion)">
                    @item.Text
                </option>
            }
        </select>
    </div>

    <div class="col-md-2">
        <select class="form-select" name="elemento">
            <option value="">Elemento</option>
            @foreach (var item in Model.Elementos)
            {
                <option value="@item.Value" selected="@(item.Value == Model.Elemento)">
                    @item.Text
                </option>
            }
        </select>
    </div>

    <div class="col-md-2">
        <select class="form-select" name="rol">
            <option value="">Rol</option>
            @foreach (var item in Model.Roles)
            {
                <option value="@item.Value" selected="@(item.Value == Model.Rol)">
                    @item.Text
                </option>
            }
        </select>
    </div>

    <input type="hidden" name="orden" value="@Model.Orden" />

    <div class="col-12">
        <button class="btn btn-primary">Aplicar</button>
        <a asp-action="Index" class="btn btn-outline-secondary">Reset</a>
    </div>
</form>

<!-- TABLA -->
<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>
                    <a class="link-light text-decoration-none"
                       href="@BuildUrlOrden(Toggle("Id"))">
                        @("Id" + Arrow("Id"))
                    </a>
                </th>
                <th>Img</th>

                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Nombre"))">@("Nombre" + Arrow("Nombre"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Apodo"))">@("Apodo" + Arrow("Apodo"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Juego"))">@("Juego" + Arrow("Juego"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Arquetipo"))">@("Arquetipo" + Arrow("Arquetipo"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Posicion"))">@("Posición" + Arrow("Posicion"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Elemento"))">@("Elemento" + Arrow("Elemento"))</a></th>
                <th><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Rol"))">@("Rol" + Arrow("Rol"))</a></th>

                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Potencia"))">@("Pot." + Arrow("Potencia"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Control"))">@("Ctrl" + Arrow("Control"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Tecnica"))">@("Téc" + Arrow("Tecnica"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Presion"))">@("Pres" + Arrow("Presion"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Fisico"))">@("Fís" + Arrow("Fisico"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Agilidad"))">@("Agi" + Arrow("Agilidad"))</a></th>
                <th class="text-end"><a class="link-light text-decoration-none" href="@BuildUrlOrden(Toggle("Total"))">@("Total" + Arrow("Total"))</a></th>
            </tr>
        </thead>

        <tbody>
            @foreach (var j in Model.Jugadores)
            {
                <tr>
                    <td>@j.Id</td>
                    <td>
                        <img src="@j.Imagen" width="40" loading="lazy"
                             onerror="this.style.display='none';" />
                    </td>
                    <td>@j.Nombre</td>
                    <td>@j.Apodo</td>
                    <td>@j.Juego</td>
                    <td>@j.Arquetipo</td>
                    <td>@j.Posicion</td>
                    <td>@j.Elemento</td>
                    <td>@j.Rol</td>
                    <td class="text-end">@((j.Potencia?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Control?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Tecnica?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Presion?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Fisico?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Agilidad?.ToString() ?? "???"))</td>
                    <td class="text-end">@((j.Total?.ToString() ?? "???"))</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- MODO OSCURO -->
@section Scripts {
    <script>
        (function () {
            const key = "vr_theme";
            const btn = document.getElementById("themeToggle");
            const body = document.body;

            function apply(theme) {
                if (theme === "dark") {
                    body.classList.add("dark-mode");
                    btn.textContent = "☀️ Modo claro";
                } else {
                    body.classList.remove("dark-mode");
                    btn.textContent = "🌙 Modo oscuro";
                }
            }

            const saved = localStorage.getItem(key) || "light";
            apply(saved);

            btn.addEventListener("click", function () {
                const next = body.classList.contains("dark-mode") ? "light" : "dark";
                localStorage.setItem(key, next);
                apply(next);
            });
        })();
    </script>
}

<style>
    .dark-mode {
        background-color: #0f1115;
        color: #e6e6e6;
    }

        .dark-mode .table {
            color: #e6e6e6;
        }

        .dark-mode .table-dark {
            background-color: #0b0e14;
        }

        .dark-mode .form-control,
        .dark-mode .form-select {
            background-color: #0f1115;
            color: #e6e6e6;
        }
</style>
